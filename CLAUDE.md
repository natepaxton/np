# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is an Nx monorepo workspace containing an Angular 20.3 application with Server-Side Rendering (SSR) support. The workspace uses Nx 22.1.3 for build orchestration, task management, and code generation.

## Model Context Protocol Servers

Claude should use the installed MCP servers
 - github
 - playwright
 - nx-mcp

## Unit Tests

Unit tests generated by claude should use a class based approach and not the angular TestBed.

## Commands

### Development

```bash
# Serve the web app in development mode
npx nx serve web

# Build the web app for production
npx nx build web

# Build for development (no optimization, with source maps)
npx nx build web --configuration=development
```

### Testing

```bash
# Run unit tests for the web app
npx nx test web

# Run tests in CI mode with code coverage
npx nx test web --configuration=ci

# Run e2e tests with Playwright
npx nx e2e web-e2e
```

### Linting

```bash
# Lint the web app
npx nx lint web

# Lint all projects in the workspace
npx nx run-many -t lint
```

### Nx Utilities

```bash
# View project details and available targets
npx nx show project web

# Visualize project dependency graph
npx nx graph

# List available Nx plugins
npx nx list

# Generate new Angular application
npx nx g @nx/angular:app <app-name>

# Generate new Angular library
npx nx g @nx/angular:lib <lib-name>
```

## Architecture

### Workspace Structure

- **apps/web**: Main Angular application with SSR support
  - `src/app`: Application components, routes, and configuration
  - `src/server.ts`: Express server for SSR
  - `src/main.ts`: Browser entry point
  - `src/main.server.ts`: Server entry point
- **apps/web-e2e**: Playwright end-to-end tests for the web application

### SSR (Server-Side Rendering)

The application uses Angular Universal with an Express server (`apps/web/src/server.ts`). The server:
- Serves static files from `/browser` with 1-year caching
- Uses `AngularNodeAppEngine` to handle server-side rendering
- Supports custom Express API endpoints (add them before the Angular handler)
- Defaults to port 4000 (configurable via `PORT` environment variable)

### Component Architecture

Angular 20.3 uses standalone components by default:
- Components import dependencies directly via the `imports` array
- No `NgModule` declarations required
- See `apps/web/src/app/app.ts` for the root component structure

### Configuration Files

- **nx.json**: Nx workspace configuration with caching, task dependencies, and plugin settings
- **tsconfig.base.json**: Base TypeScript configuration for the workspace
- **eslint.config.mjs**: ESLint configuration using flat config format with Nx plugin
- **apps/web/project.json**: Defines build targets, executors, and configurations for the web app

### Build System

The project uses Angular's new application builder (`@angular/build:application`):
- Outputs to `dist/apps/web` with separate `browser` and `server` directories
- Production builds use output hashing and have budget constraints (500kb warning, 1mb error for initial bundle)
- Development builds skip optimization and include source maps

### Testing

- **Unit tests**: Jest with `jest-preset-angular`
- **E2E tests**: Playwright (configured via `@nx/playwright/plugin`)
- Test setup files located at `apps/web/src/test-setup.ts`

## Nx Task Graph

Nx automatically handles task dependencies:
- Build tasks depend on dependent projects' builds (`dependsOn: ["^build"]`)
- Nx caches task results to speed up subsequent runs
- Tasks are configured in `nx.json` under `targetDefaults`
